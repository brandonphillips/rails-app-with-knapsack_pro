machine:
  ruby:
    version: 2.2.3
  environment:
    # In production you should use endpoint http://api.knapsackpro.com
    # which is default so it means you don't need to set KNAPSACK_PRO_ENDPOINT
    # Below endpoint is just for internal tests by KnapsackPro developers.
    KNAPSACK_PRO_ENDPOINT: http://api-staging.knapsackpro.com

    # Tokens are set in CircleCI settings so you can't read them from this file.
    # KNAPSACK_PRO_TEST_SUITE_TOKEN_RSPEC: rspec-token
    # KNAPSACK_PRO_TEST_SUITE_TOKEN_CUCUMBER: cucumber-token
    # KNAPSACK_PRO_TEST_SUITE_TOKEN_MINITEST: minitest-token
dependencies:
  pre:
    - gem install rrrspec-server

    - sudo curl -sSL https://get.rvm.io | bash -s stable
    - sudo rvm install 2.2.3
    - sudo ruby -v
    - sudo gem install bundler
    - sudo gem install rrrspec-server
    - sudo bundle install
test:
  pre:
    - sudo rrrspec-server server --config=rrrspec-server-config.rb
    - sudo rrrspec-server worker --config=rrrspec-server-config.rb
  override:
    - sudo bundle exec rrrspec-client start
